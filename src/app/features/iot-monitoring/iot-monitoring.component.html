<div class="container-fluid">

  <!-- Stats Grid -->
  <div class="row g-4 mb-4">
    <div class="col-sm-6 col-lg-3" *ngFor="let s of stats">
      <div class="card shadow-sm border-0 stat-card">
        <div class="card-body">
          <div class="icon-box" [ngClass]="s.color">
            <i class="bi" [ngClass]="s.icon"></i>
          </div>
          <p class="text-muted mt-3">{{ s.label }}</p>
          <h4>{{ s.value }}</h4>
          <small class="text-secondary text-capitalize">{{ s.status }}</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Room Filter -->
  <div class="card mb-4 border-0 shadow-sm">
    <div class="card-body d-flex gap-2 flex-wrap">
      <button
        class="btn"
        [ngClass]="selectedRoom ? 'btn-light' : 'btn-primary'"
        (click)="selectedRoom=null">
        All Rooms
      </button>

      <button
        *ngFor="let r of rooms"
        class="btn"
        [ngClass]="selectedRoom === r ? 'btn-primary' : 'btn-light'"
        (click)="selectedRoom=r">
        Room {{ r }}
      </button>
    </div>
  </div>

  <!-- Devices Grid -->
  <div class="row g-4 mb-4">
    <div class="col-md-6 col-lg-4" *ngFor="let d of filterDevices()">
      <div class="card device-card border-0 shadow-sm">

        <div class="card-body">

          <!-- Top Section -->
          <div class="d-flex justify-content-between align-items-start mb-3">

            <!-- Icon + Info -->
            <div class="d-flex align-items-center gap-3">
              <div class="device-icon" [ngClass]="getStatusClass(d.status)">
                <i class="bi" [ngClass]="getDeviceIcon(d.type)"></i>
              </div>

              <div>
                <h5 class="mb-0">{{ d.type }}</h5>
                <small class="text-muted">Room {{ d.room }}</small>
              </div>
            </div>

            <!-- Status Badge -->
            <span class="badge px-3 py-2"
                  [ngClass]="getStatusClass(d.status)">
              {{ d.status }}
            </span>
          </div>

          <!-- Info Rows -->
          <div class="d-flex justify-content-between mb-2">
            <span class="text-muted">Current Value</span>
            <span class="fw-semibold">
              {{ d.value }}
              <i class="bi ms-1" [ngClass]="getTrendIcon(d.trend)"></i>
            </span>
          </div>

          <div class="d-flex justify-content-between">
            <span class="text-muted">Last Update</span>
            <span class="text-secondary">{{ d.lastUpdate }}</span>
          </div>

          <!-- Warning -->
          <div *ngIf="d.status === 'warning'" class="alert alert-warning mt-3 py-2">
            <i class="bi bi-exclamation-triangle me-2"></i> Attention Required
          </div>

          <!-- Offline Action -->
          <button *ngIf="d.status === 'offline'"
                  class="btn btn-danger w-100 mt-3">
            Check Device
          </button>

        </div>

      </div>
    </div>
  </div>

  <!-- Energy Analytics + Alerts -->
  <div class="row g-4 mt-4">

    <div class="col-lg-6">
      <div class="card shadow-sm border-0 p-4 energy-card">

        <h5 class="mb-4">Energy Consumption by Floor</h5>

        <div *ngFor="let f of [
            { floor: '1st Floor', usage: 85 },
            { floor: '2nd Floor', usage: 72 },
            { floor: '3rd Floor', usage: 65 },
            { floor: '4th Floor', usage: 58 }]">

          <div class="d-flex justify-content-between mb-1">
            <span>{{ f.floor }}</span>
            <span>{{ f.usage }} kWh</span>
          </div>

          <div class="progress mb-3">
            <div class="progress-bar bg-primary"
                 [style.width.%]="f.usage">
            </div>
          </div>

        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card shadow-sm border-0 p-4 alerts-card">
        <h5 class="mb-4">System Alerts</h5>

        <div *ngFor="let a of [
          { type: 'warning', message: 'Room 102 AC temperature high', time: '5 min ago' },
          { type: 'error', message: 'Room 105 AC offline', time: '15 min ago' },
          { type: 'info', message: 'Room 201 door unlocked', time: '20 min ago' },
          { type: 'warning', message: 'High energy usage detected - Floor 1', time: '1 hour ago' }
        ]"
        class="alert"
        [ngClass]="{
          'alert-danger': a.type === 'error',
          'alert-warning': a.type === 'warning',
          'alert-info': a.type === 'info'
        }">

          <div class="d-flex gap-3">
            <i class="bi bi-exclamation-triangle"></i>
            <div>
              <div class="fw-semibold">{{ a.message }}</div>
              <small class="text-muted">{{ a.time }}</small>
            </div>
          </div>

        </div>
      </div>
    </div>

  </div>

</div>
